<!DOCTYPE html>
<html lang=en-QC-2sbs>
<head>
<meta charset="utf-8">
<title>SmileBASIC Source 2</title>

<meta name=viewport content="width=device-width, initial-scale=1, height=device-height">
<link rel=icon sizes=16x16 data-favicon href=resource/icon16.ico> <!-- compatibility -->
<link rel="shortcut icon" sizes=16x16 data-favicon href=resource/icon16.png> <!-- firefox -->
<link rel=icon sizes=32x32 data-favicon href=resource/icon32.png> <!-- chrome -->
<link rel=icon sizes=192x192 data-favicon href=resource/iconbig.png> <!-- large -->
<link rel=apple-touch-icon href=resource/iconbig.png> <!-- large 2 -->
<link rel=image_src href=resource/iconbig.png> <!-- large 3 -->

<script>
	window.onerror = function(message, source, line, col, error) {
		alert("ERROR DURING PAGE LOAD!\n"+message+"\nin "+source+"\nat "+line+":"+col)
	}
</script>

<!--START-->
<!-- this part will be replaced by the build script -->
<link rel=stylesheet href=src/theme.css>
<link rel=stylesheet href=resource/fonts.css>
<link rel=stylesheet href=src/layout.css>
<link rel=stylesheet href=src/style.css>
<link rel=stylesheet href=markup2/markup.css>
<link rel=stylesheet href=src/code.css>

<script src=src/fill.js></script>

<script src=src/ABOUT.js></script>
<script src=src/entity.js></script>
<script src=src/activity.js></script>
<script src=src/request.js></script>
<script src=src/socket.js></script>

<script src=markup2/parse.js></script>
<script src=markup2/render.js></script>
<script src=markup2/legacy.js></script>

<script src=src/draw.js></script>
<script src=src/input.js></script>

<script src=src/view.js></script>
<script src=src/settings.js></script>
<script src=src/scroller.js></script>
<script src=src/sidebar.js></script>
<script src=src/chat.js></script>

<script src=src/Views/page.js></script>
<script src=src/Views/images.js></script>
<script src=src/Views/editpage.js></script>
<script src=src/Views/category.js></script>
<script src=src/Views/user.js></script>
<script src=src/Views/home.js></script>
<script src=src/Views/comments.js></script>

<script src=src/navigate.js></script>

<script src=src/main.js></script>
<!--END-->
<style id=$customCSS></style>

</head>

<body class='flex'>

<!--=======\
|| HEADER ||
\========-->

<header class='titlePane bar rem2-3 loadBG' id=$titlePane>
	<div class='textItem rightAlign'>
		<button id=$openSidebar class='item'>|||</button>
	</div>
	
	<a data-static-path="" class='textItem'><img class='item' src=resource/iconbig.png alt="SBS"></a>
	<noscript>This web-site requires JavaScript</noscript>
	<span data-view=page,category id=$path></span>
	<h1 id=$pageTitle class='textItem pageTitle'></h1>
	<span data-view=page>
		<a data-static-path class='textItem canEdit' id=$pageEditLink>[Edit]</a>
		<a data-static-path class='textItem' id=$pageCommentsLink>[Logs]</a>
	</span>
	<span data-view=user><a class='textItem loggedIn myUserPage' id=$editUserPage>Edit User Page</a></span>
	<span class='item loggedIn myUserPage'>
		<div id=$userPageStatus class='textItem'></div>
	</span>
	<span data-view=editpage,catEditMode>
		<input class='item' id=$titleInput placeholder="Title" required>
		<button class='item' id=$submitEdit>Submit</button>
		<button class='item' id=$deletePage>DELETE</button>
	</span>
</header>

<horizontal-split class='grow resize-box row'>
	<main class='grow slide-box' id=$main_slides>
		<!--==============\
		|| MAIN CONTENTS ||
		\===========--==-->
		<div data-slide=images class='flex'>
			<div class='rem1-7 bar nav'>
				<span id=$fileNav></span>
		  		<label>Bucket:<input id=$fileSearchBucket></label>
				<div class='rightAlign'>Upload images in sidebar â†’</div>
			</div>
			<div class='bar' id=$fileBox></div>
			Click an image to select
			<span class='fileSelected'>
				<button id=$setAvatarButton class='loggedIn'>Use As Avatar</button>
				<a id=$fileDownload class='' target="_blank">Download</a>
				<button id=$fileUpdateButton class='rightAlign canEdit loggedIn'>Save Settings</button>
			</span>
			<div class='fileSelected' id=$imageForm></div>
			<div class='image-box grow'><img id=$filePageView></div>
		</div>
		
		<div data-slide=users>
			<div class='nav bar rem1-7' id=$memberNav></div>
			<div id=$memberList class='border-list-2'></div>
		</div>
		
		<div data-slide=user>
			<div class='userPageBox flex-row'>
				<a id=$userPageAvatarLink class='userPageAvatar'><img id=$userPageAvatar alt="" src=""></a>
				<scroll-outer class='pageContents userPageContents markup-root' id=$userPageContents></scroll-outer>
			</div>
			<div class='userActivity' id=$userActivity></div>
		</div>
		
		<div data-slide=category>
			<div id=$categoryDescription class='categoryDescription pageContents markup-root'></div>
			<div id=$categoryCategories></div>
			<div id=$categoryPinned></div>
			<div class='rem1-7 bar'>
				<span id=$categoryNav></span>
				<button id=$createPage class='item' data-static-link>Create Page</button>
				<button id=$editCategory class='item canEdit' data-static-link>Edit Category</button>
			</div>
			<div id=$categoryPages></div>
		</div>
		
		<div data-slide=error class='pre errorPage' id=$errorMessage></div>
		
		<div data-slide=comments>
			<div id=$commentSearch class='nav'>
				<br id=$commentSearchForm>
				<button id=$commentSearchButton>Search</button>
			</div>
			<div id=$commentSearchResults></div>
		</div>
		
		<!-- todo: add category editor page? -->
		<div data-slide=home class='border-list'>
			<div>
				a
				<div class='gallery-inner' style="max-width: 400px;">
					<div>
						<div class='image-box fill'>
							<img id=$galleryImage>
						</div>
					</div>
					<canvas width=5 height=3>
						this canvas makes it so
						the parent element will
						have fixed aspect ratio
					</canvas>
				</div>
				<div class='gallery-title' style="max-width: 400px;" id=$galleryTitle></div>
				a
			</div>
			<div id=$homeCategories class='border-list-2'></div>
		</div>
		
		<!-- todo -->
		<div data-slide=activity id=$activity></div>
		
		<div data-slide=test>
			<textarea id=$testTextarea></textarea><br>
			<button id=$testButton>Run</button><br>
			<div id=$testOut class='pre'></div>
		</div>
		
		<div data-slide=editpage class='resize-box'>
			<div class='sized slide-box' id=$editorPreviewPane>
				<div data-slide=form>
					<div class='registerBox' id=$editPageForm></div> <!-- really what we want here is a marker, not a container element or a replaced element. I would use <br> and then .replaceWith(form.elem), then set the form's .id back to $editPageForm. but that feels unsafe for something which could be generated many times. plus we have to set it back when cleaning up. -->
				</div>
				<div data-slide=preview>
					<div id=$editorPreview class='markup-root pageContents'></div>
				</div>
			</div>
			<resize-handle id=$editorPreviewResize><button id=$toggleEditorMode>Toggle Preview</button></resize-handle>
			<div>
				<label>Markup language:<select id=$markupSelect>
					<option value="plaintext">plain text</option>
					<option value="12y">12-y documentation markup format</option>
					<option disabled value="bbcode">bbcode</option>
				</select></label>
				<button id=$markupUpdate>Update Preview</button>
			</div>
			<textarea id=$editorTextarea minlength=2 required class='grow'></textarea>
		</div>
		
		<div data-slide=page id=$chatContainer class='flex'>
			<div id=$chatPaneBox class='grow slide-box'></div>
			<div class='inputPane loggedIn flex-row'>
				<button class='showWhenEdit' id=$chatCancelEdit>Cancel Edit</button>
				<textarea-container class='grow'>
					<div id=$chatTextareaWidth></div>
					<textarea class='chatTextarea' id=$chatTextarea accesskey="z"></textarea>
				</textarea-container>
				<div>
					<label class='no-select'>Markup:<input type=checkbox checked autocomplete=off id=$chatMarkupSelect></label>
				</div>
			</div>
		</div>
	</main>
	
	<!--========\
	|| SIDEBAR ||
	\=========-->
	
	<resize-handle id=$horizontalResize class='sidebar-element'></resize-handle>
	
	<sidebar-container id=$sidebar class='sized resize-box sidebar-element'>
		<button class='closeSidebar' id=$closeSidebar>Close Sidebar</button>
		<div class='userlist bar rem1-5'><span id=$sidebarUserList></span><button id=$hideGlobalStatusButton class='item rightAlign loggedIn'>Hide</button></div>
		<!--<span id=$longPollStatus></span>-->
		<tab-list id=$sidebar_tabs role="tablist" aria-label="sidebar tab"></tab-list>
		<div id=$sidebarTop class='sized slide-box'>
			<sidebar-panel id=$sidebarActivityPanel>
				<scroll-outer><scroll-inner id=$sidebarActivity class='border-list-2'></scroll-inner></scroll-outer>
			</sidebar-panel>
			<sidebar-panel id=$sidebarWatchPanel>
				<scroll-outer><scroll-inner id=$sidebarWatch class='border-list-2'></scroll-inner></scroll-outer>
			</sidebar-panel>
			<sidebar-panel id=$sidebarNavPanel>
				<div class='bar rem1-5'><input id=$searchInput class='item'><button id=$searchButton class='item'>Search</button></div>
				<div id=$searchResults></div>
				<div id=$sidebarCategories></div>
			</sidebar-panel>
			<sidebar-panel id=$sidebarFilePanel class='flex'>
				<div class='rem1-5 flex-row justify-between'>
					<input type=file accept="image/*" id=$file_browse class='grow item'>
					<button id=$file_cancel class='item'>Cancel</button>
					<input readonly id=$file_url class='grow'>
					<button id=$file_done class='item'>Done</button>
					<button id=$file_upload class='item'>Upload Image</button>
				</div>
				<br id=$file_upload_form>
				<div class='image-box grow' style="min-height: 3rem;"><img id=$file_image></div>
				<a data-static-path=images>Uploaded Images</a> <!-- I want to move this into the upper bar so it takes up less space... -->
			</sidebar-panel>
			<sidebar-panel id=$sidebarUserPanel>
				<div class='registerBox'>
					<button onclick="window.location.search = window.location.search ? '' : '?'">Reload Page</button>
					<a id=$haloopdyLink>H</a>
					<button class='rightAlign' id=$logOut>Log out</button>
				</div>
				<div class='loggedOut'>
					<div class='registerBox'>
						<h2>Log In</h2>
						<form id=$loginForm method=dialog>
							<input placeholder=Username name=username><br>
							<input placeholder=Password name=password type=password autocomplete=current-password><br>
							<button>Log In</button>
						</form>
						<div id=$loginError></div>
					</div>
				</div>
				<div class='loggedIn border-list'>
					<div class='registerBox'>
						<a data-static-path=images>Change your avatar here</a>
					</div>
					<div class='registerBox'>
						<a data-static-path=users>User list</a>
					</div>
					<div class='registerBox'>
						<div id=$localSettings></div>
						<button id=$localSettingsSave>Update sitejs/sitecss</button>
					</div>
					<div class='registerBox'>
						<h3>Change account settings</h3>
						<form id=$changeForm method=dialog>
							<input placeholder="Old Password" name=oldPassword minlength=8 type=password autocomplete=off><br>
							Only fill out the fields you want to change:<br>
							<input placeholder="New Username" name=username minlength=2 maxlength=20> 2 to 20 characters, no spaces<br>
							<input placeholder="New Password" name=password type=password minlength=8><input placeholder="Confirm New Password" name=password2 type=password minlength=8> At least 8 characters<br>
							<input placeholder="New Email" name=email type=email><input placeholder="Confirm New Email" name=email2 type=email><br>
							<button>Save</button>
						</form>
						<div id=$userSettingsError class='pre'></div>
					</div>
				</div>
			</sidebar-panel>
		</div>
		<resize-handle id=$sidebarResize></resize-handle>
		<div id=$sidebarBottom class='grow'>
			<scroll-outer><scroll-inner id=$sidebarScroller class='border-list'></scroll-inner></scroll-outer>
		</div>
	</sidebar-container>
</horizontal-split>

</body>
<script hidden>
	// whitespace between nodes in html (due to line breaks, indentation, etc.) creates text nodes which need to be stripped:
	let walker = document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT, {acceptNode: node=>/^\s+$/.test(node.textContent)})
	let blank_nodes = []
	while (walker.nextNode())
		blank_nodes.push(walker.currentNode)
	// remove in 1 step rather than calling .remove() one at a time
	document.createElement('gay-baby-jail').append(...blank_nodes)
	//console.log("removed "+blank_nodes.length+" blank text nodes")
</script>
