<!DOCTYPE html>
<html lang=en-QS>
<meta charset=utf-8>
<title>SmileBASIC Source 2</title>

<meta name=viewport content="width=device-width, initial-scale=1, height=device-height">

<meta name=application-name content="sbs2">
<link rel=icon sizes=16x16 href=resource/icon16.ico> <!-- compatibility -->
<link rel=icon sizes=16x16 href=resource/icon16.png> <!-- firefox -->
<link rel=icon sizes=32x32 href=resource/icon32.png> <!-- chrome -->
<link rel=icon sizes=192x192 href=resource/iconbig.png> <!-- large -->
<link rel=apple-touch-icon href=resource/iconbig.png> <!-- large 2 -->
<link rel=image_src href=resource/iconbig.png> <!-- large 3 -->
<meta name=color-scheme content="light dark">
<meta name=theme-color content="#888"> <!-- mobile -->

<!--<link rel=dns-prefetch href=https://qcs.shsbs.xyz>
<link rel=preconnect href=https://qcs.shsbs.xyz crossorigin>-->

<script>
	if (window.location.search=="?logout") {
		window.localStorage.removeItem("token-qcs.shsbs.xyz/api")
		window.location.search = ""
	}
	window.print = window.alert
	
	var markup_warned
	function check_markup() {
		return "yeah"===window.getComputedStyle(document.documentElement).getPropertyValue('--Markup-loaded')
	}
	
	window.onerror = function(message, source, line, col, error) {
		if (!markup_warned && !check_markup()) {
			markup_warned = true
			alert("‚ùìMISSING SUBMODULE DETECTED!\nü©∏Check: "+new URL('markup2/',window.location).href+"\nü©∏If the ‚Äòmarkup2‚Äô folder is empty:\nü©∏\nü©∏Run: git submodule update --init\nü©∏or download the files manually at:\nü©∏https://github.com/12Me21/markup2")
		}
		
		(window.queueMicrotask || window.setTimeout)(function() {
			if (confirm("üéÜ ERROR DURING PAGE LOAD!\n"+line+":"+col+" in "+source+"\n\n"+message+"\n\n[Cancel] = reload page, [Ok] = continue"))
				window.onerror = null
			else
				RELOAD()
		})
	}
	function RELOAD() {
		var l=window.location.href
		window.history.replaceState(null, "", "?‚åõ")
		window.location.replace(l)
	}
</script>

<!--START-->
<!-- this part will be replaced by the build script -->
<link rel=stylesheet href=resource/fonts.css>
<link rel=stylesheet href=src/layout.css>
<link rel=stylesheet href=src/style.css>
<link rel=stylesheet href=markup2/markup.css>
<link rel=stylesheet href=src/theme.css>
<link rel=stylesheet href=src/code.css>

<script src=markup2/langs.js></script>
<script src=markup2/parse.js></script>
<script src=markup2/legacy.js></script>
<script src=markup2/render.js></script>
<script src=markup2/runtime.js></script>
<script src=markup2/helpers.js></script>

<script src=markup2/url.js></script>

<script src=src/fill.js></script>

<script src=src/ABOUT.js></script>
<script src=src/entity.js></script>
<script src=src/activity.js></script>
<script src=src/request.js></script>
<script src=src/socket.js></script>

<script src=src/draw.js></script>
<script src=src/input.js></script>

<script src=src/view.js></script>
<script src=src/settings.js></script>
<script src=src/scroller.js></script>
<script src=src/sidebar.js></script>
<script src=src/chat.js></script>

<script src=src/Views/page.js></script>
<script src=src/Views/user.js></script>
<script src=src/Views/comments.js></script>

<script src=src/navigate.js></script>

<script src=src/main.js></script>
<!--END-->
<style id=$customCSS></style>

<body üÅ¢>

<!--=======\
|| HEADER ||
\========-->

<header class='titlePane bar rem2-3 loadBG' id=$titlePane>
	<div class='textItem rightAlign'>
		<button id=$openSidebar class='item'>
			<span id=$socketPending></span>
			| | |
			<!--<img src=resource/iconbig.png alt="SBS" width=32px height=32px>‚•Ñ-->
		</button>
	</div>
	<noscript>This web-site requires JavaScript</noscript>
	<h1 id=$pageTitle class='textItem pageTitle'></h1>
	<span data-view=page><a class='textItem' id=$pageCommentsLink>[Logs]</a></span>
</header>

<horizontal-split ñß† class='resize-box' üÄ∞>
	<main ñß† id=$main_slides üì∫>
		<!--==============\
		|| MAIN CONTENTS ||
		\===========--==-->
		<div data-slide=error class='errorPage' id=$errorMessage ü™ß></div>
		
		<div data-slide=comments>
			<div id=$commentSearch class='nav'>
				<br id=$commentSearchForm>
				<button id=$commentSearchButton>üîçSearch</button>
				<button id=$commentSearchPrev>‚óÄprev</button>
				<button id=$commentSearchNext>next‚ñ∂</button>
				<span id=$commentSearchStatus></span>
			</div>
			<div id=$commentSearchResults></div>
		</div>
		
		<div data-slide=test>
			<textarea id=$testTextarea></textarea><br>
			<button id=$testButton>Run</button><br>
			<div id=$testOut ü™ß></div>
			<textarea id=$testInput></textarea><br>
			<div style='display:flex;'>
				<div id=$testOut2 ü™ß></div>
				<div id=$testOut3 ü™ß></div>
				<div id=$testOut4 ü™ß></div>
			</div>
		</div>
		
		<div data-slide=user>
			<img id=$userPageAvatar width=400 height=400>
			<div id=$userPageContents class='pageContents Markup'></div>
		</div>
		
		<div data-slide=page id=$chatContainer üÅ¢>
			<div ñß† id=$chatPaneBox üì∫></div>
			<div class='inputPane loggedIn' üÄ∞>
				<button class='showWhenEdit' id=$chatCancelEdit>Cancel Edit</button>
				<textarea-container ñß†>
					<div id=$chatTextareaWidth></div>
					<textarea class='chatTextarea' id=$chatTextarea accesskey="z"></textarea>
				</textarea-container>
				<div>
					<label class='no-select'>Markup:<input type=checkbox checked autocomplete=off id=$chatMarkupSelect></label>
				</div>
			</div>
		</div>
	</main>
	
	<!--========\
	|| SIDEBAR ||
	\=========-->
	
	<resize-handle id=$horizontalResize class='sidebar-element'></resize-handle>
	
	<sidebar-container id=$sidebar class='sized resize-box sidebar-element' üÅ¢>
		<button class='closeSidebar' id=$closeSidebar>Close Sidebar</button>
		<div class='userlist bar rem1-5' id=$sidebarUserList></div>
		<!--<span id=$longPollStatus></span>-->
		<tab-list id=$sidebar_tabs role="tablist" aria-label="sidebar tab"></tab-list>
		<div id=$sidebarTop class='sized' üì∫>
			<sidebar-panel id=$sidebarActivityPanel>
				<scroll-outer id=$sidebarActivity></scroll-outer>
			</sidebar-panel>
			<sidebar-panel id=$sidebarWatchPanel>
				<scroll-outer><scroll-inner id=$sidebarWatch class='border-list-2'></scroll-inner></scroll-outer>
			</sidebar-panel>
			<sidebar-panel id=$sidebarNavPanel>
				<div üÄ∞><input ñß† id=$searchInput><button id=$searchButton class='item'>Search</button></div>
				<div id=$searchResults></div>
				<div id=$sidebarCategories></div>
			</sidebar-panel>
			<sidebar-panel id=$sidebarFilePanel üÅ¢>
				<div class='rem1-5 justify-between' üÄ∞>
					<input ñß† type=file accept="image/*" id=$file_browse class='item'>
					<button id=$file_cancel class='item'>Cancel</button>
					<input ñß† readonly id=$file_url>
					<button id=$file_done class='item'>Done</button>
					<button id=$file_upload class='item'>Upload Image</button>
				</div>
				<br id=$file_upload_form>
				<div ñß† class='image-box' style="min-height: 3rem;"><img id=$file_image></div>
			</sidebar-panel>
			<sidebar-panel id=$sidebarUserPanel>
				<div class='registerBox'>
					<button onclick='RELOAD()'>Reload Page</button>
					<button onclick='Lp.start_websocket(true)'>Reset Socket</button>
					<button class='rightAlign' id=$logOut>Log out</button>
				</div>
				<div class='loggedOut'>
					<div class='registerBox'>
						<h2>Log In</h2>
						<form id=$loginForm method=dialog>
							<input placeholder=Username name=username><br>
							<input placeholder=Password name=password type=password autocomplete=current-password><br>
							<button>Log In</button>
						</form>
						<div id=$loginError></div>
					</div>
				</div>
				<div class='loggedIn border-list'>
					<div class='registerBox'>
						<div id=$localSettings></div>
						<button id=$localSettingsSave>Update sitejs/sitecss</button>
					</div>
				</div>
			</sidebar-panel>
		</div>
		<resize-handle id=$sidebarResize></resize-handle>
		<div ñß† id=$sidebarBottom>
			<scroll-outer><scroll-inner id=$sidebarScroller class='border-list'></scroll-inner></scroll-outer>
		</div>
	</sidebar-container>
</horizontal-split>

</body>
<script hidden>
	document.currentScript.remove() // üí≠
	// whitespace between nodes in html (due to line breaks, indentation, etc.) creates text nodes which need to be stripped:
	document.createNodeIterator(
		document.body, NodeFilter.SHOW_TEXT,
		{acceptNode(node){node.data.trim()||node.remove()}},
	).nextNode()
	console.log("üåÖ removed blank textnodes")
	
	let dcl = Math.random()<0.5
	if (dcl)
		document.addEventListener('DOMContentLoaded', dom_ready)
	else
		dom_ready()
	window.addEventListener('load', e => {
		let x = localStorage.getItem('LOAD_TIMING')
		x += "\n"+(dcl?"DCL":"BS")+";"+Object.values(performance.timing.toJSON()).map(x=>x.toString(36)).join(",")
		localStorage.setItem('LOAD_TIMING', x)
	})
</script>
