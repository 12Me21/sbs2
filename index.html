<!DOCTYPE html>
<html lang=en-QC-2sbs>
<head>
<meta charset="utf-8">
<title>SmileBASIC Source 2</title>

<meta name=viewport content="width=device-width, initial-scale=1, height=device-height">
<link rel=icon sizes=16x16 data-favicon href=resource/icon16.ico> <!-- compatibility -->
<link rel="shortcut icon" sizes=16x16 data-favicon href=resource/icon16.png> <!-- firefox -->
<link rel=icon sizes=32x32 data-favicon href=resource/icon32.png> <!-- chrome -->
<link rel=icon sizes=192x192 data-favicon href=resource/iconbig.png> <!-- large -->
<link rel=apple-touch-icon href=resource/iconbig.png> <!-- large 2 -->
<link rel=image_src href=resource/iconbig.png> <!-- large 3 -->

<script>
	window.onerror = function(message, source, line, col, error) {
		window.setTimeout(function() {
			if (confirm("ERROR DURING PAGE LOAD!\n"+message+"\nin "+source+"\nat "+line+":"+col+"\n[Cancel] = reload page, [Ok] = continue"))
				return window.onerror = null
			RELOAD()
		}, 0)
	}
	function RELOAD() {
		var l=window.location.href
		window.history.replaceState(null, "", "?âŒ›")
		window.location.replace(l)
	}
</script>

<!--START-->
<!-- this part will be replaced by the build script -->
<link rel=stylesheet href=src/theme.css>
<link rel=stylesheet href=resource/fonts.css>
<link rel=stylesheet href=src/layout.css>
<link rel=stylesheet href=src/style.css>
<link rel=stylesheet href=markup2/markup.css>
<link rel=stylesheet href=src/code.css>

<script src=markup2/parse.js></script>
<script src=markup2/render.js></script>
<script src=markup2/legacy.js></script>
<script src=markup2/helpers.js></script>

<script src=src/fill.js></script>

<script src=src/ABOUT.js></script>
<script src=src/entity.js></script>
<script src=src/activity.js></script>
<script src=src/request.js></script>
<script src=src/socket.js></script>

<script src=src/draw.js></script>
<script src=src/input.js></script>

<script src=src/view.js></script>
<script src=src/settings.js></script>
<script src=src/scroller.js></script>
<script src=src/sidebar.js></script>
<script src=src/chat.js></script>

<script src=src/Views/page.js></script>
<script src=src/Views/images.js></script>
<script src=src/Views/editpage.js></script>
<script src=src/Views/category.js></script>
<script src=src/Views/user.js></script>
<script src=src/Views/comments.js></script>

<script src=src/navigate.js></script>

<script src=src/main.js></script>
<!--END-->
<style id=$customCSS></style>

</head>

<body class='flex'>

<!--=======\
|| HEADER ||
\========-->

<header class='titlePane bar rem2-3 loadBG' id=$titlePane>
	<div class='textItem rightAlign'>
		<button id=$openSidebar class='item'><img src=resource/iconbig.png alt="SBS" width=32px height=32px></button>
	</div>
	
	<noscript>This web-site requires JavaScript</noscript>
	<span data-view=page,category id=$path></span>
	<h1 id=$pageTitle class='textItem pageTitle'></h1>
	<span data-view=page>
		<a class='textItem canEdit' id=$pageEditLink>[Edit]</a>
		<a class='textItem' id=$pageCommentsLink>[Logs]</a>
	</span>
	<span data-view=user><a class='textItem loggedIn myUserPage' id=$editUserPage>Edit User Page</a></span>
	<span class='item loggedIn myUserPage'>
		<div id=$userPageStatus class='textItem'></div>
	</span>
	<span data-view=editpage,catEditMode>
		<input class='item' id=$titleInput placeholder="Title" required>
		<button class='item' id=$submitEdit>Submit</button>
		<button class='item' id=$deletePage>DELETE</button>
	</span>
</header>

<horizontal-split class='grow resize-box row'>
	<main class='grow slide-box' id=$main_slides>
		<!--==============\
		|| MAIN CONTENTS ||
		\===========--==-->
		<div data-slide=error class='pre errorPage' id=$errorMessage></div>
		
		<div data-slide=comments>
			<div id=$commentSearch class='nav'>
				<br id=$commentSearchForm>
				<button id=$commentSearchButton>Search</button>
			</div>
			<div id=$commentSearchResults></div>
		</div>
		
		<div data-slide=test>
			<textarea id=$testTextarea></textarea><br>
			<button id=$testButton>Run</button><br>
			<div id=$testOut class='pre'></div>
		</div>
		
		<div data-slide=page id=$chatContainer class='flex'>
			<div id=$chatPaneBox class='grow slide-box'></div>
			<div class='inputPane loggedIn flex-row'>
				<button class='showWhenEdit' id=$chatCancelEdit>Cancel Edit</button>
				<textarea-container class='grow'>
					<div id=$chatTextareaWidth></div>
					<textarea class='chatTextarea' id=$chatTextarea accesskey="z"></textarea>
				</textarea-container>
				<div>
					<label class='no-select'>Markup:<input type=checkbox checked autocomplete=off id=$chatMarkupSelect></label>
				</div>
			</div>
		</div>
	</main>
	
	<!--========\
	|| SIDEBAR ||
	\=========-->
	
	<resize-handle id=$horizontalResize class='sidebar-element'></resize-handle>
	
	<sidebar-container id=$sidebar class='sized resize-box sidebar-element'>
		<button class='closeSidebar' id=$closeSidebar>Close Sidebar</button>
		<div class='userlist bar rem1-5' id=$sidebarUserList></div>
		<!--<span id=$longPollStatus></span>-->
		<tab-list id=$sidebar_tabs role="tablist" aria-label="sidebar tab"></tab-list>
		<div id=$sidebarTop class='sized slide-box'>
			<sidebar-panel id=$sidebarActivityPanel>
				<scroll-outer id=$sidebarActivity></scroll-outer>
			</sidebar-panel>
			<sidebar-panel id=$sidebarWatchPanel>
				<scroll-outer><scroll-inner id=$sidebarWatch class='border-list-2'></scroll-inner></scroll-outer>
			</sidebar-panel>
			<sidebar-panel id=$sidebarNavPanel>
				<div class='bar rem1-5'><input id=$searchInput class='item'><button id=$searchButton class='item'>Search</button></div>
				<div id=$searchResults></div>
				<div id=$sidebarCategories></div>
			</sidebar-panel>
			<sidebar-panel id=$sidebarFilePanel class='flex'>
				<div class='rem1-5 flex-row justify-between'>
					<input type=file accept="image/*" id=$file_browse class='grow item'>
					<button id=$file_cancel class='item'>Cancel</button>
					<input readonly id=$file_url class='grow'>
					<button id=$file_done class='item'>Done</button>
					<button id=$file_upload class='item'>Upload Image</button>
				</div>
				<br id=$file_upload_form>
				<div class='image-box grow' style="min-height: 3rem;"><img id=$file_image></div>
				<a href=#images>Uploaded Images</a> <!-- I want to move this into the upper bar so it takes up less space... -->
			</sidebar-panel>
			<sidebar-panel id=$sidebarUserPanel>
				<div class='registerBox'>
					<button onclick='RELOAD()'>Reload Page</button>
					<button class='rightAlign' id=$logOut>Log out</button>
				</div>
				<div class='loggedOut'>
					<div class='registerBox'>
						<h2>Log In</h2>
						<form id=$loginForm method=dialog>
							<input placeholder=Username name=username><br>
							<input placeholder=Password name=password type=password autocomplete=current-password><br>
							<button>Log In</button>
						</form>
						<div id=$loginError></div>
					</div>
				</div>
				<div class='loggedIn border-list'>
					<div class='registerBox'>
						<a href=#images>Change your avatar here</a>
					</div>
					<div class='registerBox'>
						<a href=#users>User list</a>
					</div>
					<div class='registerBox'>
						<div id=$localSettings></div>
						<button id=$localSettingsSave>Update sitejs/sitecss</button>
					</div>
					<div class='registerBox'>
						<h3>Change account settings</h3>
						<form id=$changeForm method=dialog>
							<input placeholder="Old Password" name=oldPassword minlength=8 type=password autocomplete=off><br>
							Only fill out the fields you want to change:<br>
							<input placeholder="New Username" name=username minlength=2 maxlength=20> 2 to 20 characters, no spaces<br>
							<input placeholder="New Password" name=password type=password minlength=8><input placeholder="Confirm New Password" name=password2 type=password minlength=8> At least 8 characters<br>
							<input placeholder="New Email" name=email type=email><input placeholder="Confirm New Email" name=email2 type=email><br>
							<button>Save</button>
						</form>
						<div id=$userSettingsError class='pre'></div>
					</div>
				</div>
			</sidebar-panel>
		</div>
		<resize-handle id=$sidebarResize></resize-handle>
		<div id=$sidebarBottom class='grow'>
			<scroll-outer><scroll-inner id=$sidebarScroller class='border-list'></scroll-inner></scroll-outer>
		</div>
	</sidebar-container>
</horizontal-split>

</body>
<script hidden>
	{
		// whitespace between nodes in html (due to line breaks, indentation, etc.) creates text nodes which need to be stripped:
		let walker = document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT, {acceptNode: node => !node.textContent.trim()})
		let blank_nodes = []
		while (walker.nextNode())
			blank_nodes.push(walker.currentNode)
		// remove in 1 step rather than calling .remove() one at a time
		document.createElement('gay-baby-jail').append(...blank_nodes)
		//console.log("removed "+blank_nodes.length+" blank text nodes")
		console.log("ðŸŒ… removed blank textnodes")
	}
</script>
