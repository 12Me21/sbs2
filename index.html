<!doctype html><html lang=en-QS><meta charset=utf-8>
<title>SmileBASIC Source 2</title>

<meta name=viewport content="width=device-width, initial-scale=1, height=device-height">

<link rel=icon sizes=16x16 href=resource/icon16.ico> <!-- compatibility -->
<link rel=icon sizes=16x16 href=resource/icon16.png> <!-- firefox -->
<link rel=icon sizes=32x32 href=resource/icon32.png> <!-- chrome -->
<link rel=icon sizes=192x192 href=resource/iconbig.png> <!-- large -->
<link rel=apple-touch-icon href=resource/iconbig.png> <!-- large 2 -->
<link rel=image_src href=resource/iconbig.png> <!-- large 3 -->

<noscript>
	<style>
		* { word-break: break-word; }
		.shadow {
			box-shadow: 0 1px 3px inset gray;
		}
		plaintext {
			white-space: pre-wrap;
			-moz-tab-size:3; tab-size:3;
			padding: 123px 10px 10px;
			text-shadow: 1px 1px 1px darkgray;
			/* we need the white bg so cleartype is enabled */
			background-color: white;
			position: relative;
			z-index: -2;
		}
	</style>
	<marquee behavior=slide scrollamount=1 height=100% direction=down>
		This web-site requires JavaScript
	</marquee>
	<hr>
	<marquee class='shadow' scrollamount=3 scrolldelay=60 direction=up>
		<plaintext><!doctype html><html lang=en-QS><meta charset=utf-8>
<title>SmileBASIC Source 2</title>

<noscript>This web-site requires JavaScript</noscript>

<meta name=application-name content="sbs2">
<link rel=author href=data:;base64,MTIM>
<link rel=vcs-git href=https://github.com/12Me21/sbs2>

<meta name=theme-color content="#888">
<meta name=color-scheme content="light dark">

<script>'use strict'
	if (window.location.search=="?logout") {
		window.localStorage.removeItem("token-qcs.shsbs.xyz/api")
		window.location.search = ""
	}
	window.print = window.alert
	
	function RELOAD() {
		var l=window.location.href
		window.history.replaceState(null, "", "?‚åõ")
		window.location.replace(l)
	}
	
	let OPTS = new URL(window.location).searchParams
	
	let BASE_URL = new URL("./", window.location).href
	
	// todo: get rid of global vars here
	var markup_warned = true
	function check_markup() {
		return "yeah"===window.getComputedStyle(document.documentElement).getPropertyValue('--Markup-loaded')
	}
	
	function alert_error(msg, message, source, line, col) {
		source = source.replace(BASE_URL, "üìÅ‚Ää")
		col = String(col).replace(/\d/g, c=>"‚ÇÄ‚ÇÅ‚ÇÇ‚ÇÉ‚ÇÑ‚ÇÖ‚ÇÜ‚Çá‚Çà‚Çâ"[c])
		if (confirm(msg+"\n"+line+"."+col+" in "+source+"\n\n"+message+"\n\n[Cancel] = reload page, [Ok] = continue"))
			window.onerror = null
		else
			RELOAD()
	}
	
	window.onerror = (message, source, line, col, error)=>{
		if (!markup_warned && !check_markup()) {
			markup_warned = true
			alert("‚ùìMISSING SUBMODULE DETECTED!\nü©∏Check: "+new URL('markup2/', window.location).href+"\nü©∏If the ‚Äòmarkup2‚Äô folder is empty:\nü©∏\nü©∏Run: git submodule update --init\nü©∏or download the files manually at:\nü©∏https://github.com/12Me21/markup2")
		}
		(window.queueMicrotask || window.setTimeout)(()=>{
			alert_error("üéÜ ERROR DURING PAGE LOAD!", message, source, line, col)
		})
	}
	
	//let store_prefix = OPTS.has('dev') ? "dev-" : ""
	
	// load settings very early
	let Settings = {
		values: Object.create(null),
	}
	if (window.location.search=="?nosettings") {
		Settings = {
			get values() { return Object.create(null) },
			get fields() { return Object.create(null) },
			set fields(v) { },
		}
	} else {
		for (let i=0; i<localStorage.length; i++) {
			let key = localStorage.key(i)
			if (key.startsWith("setting-"))
				try {
					let value = JSON.parse(localStorage.getItem(key))
					Settings.values[key.substring(8)] = value
				} catch {}
		}
	}
	
	// dark theme
	let theme_query = window.matchMedia("(prefers-color-scheme: dark)")
	theme_query.onchange = query=>{
		let theme = Settings.values.theme
		if (!theme || theme==='auto')
			document.documentElement.dataset.theme = query.matches ? 'dark' : 'light'
	}
	theme_query.onchange(theme_query)
	
	console.log("üåÖ early init done")
	markup_warned = false
</script>

<!--START-->
<!-- this part will be replaced by the build script -->
<link rel=stylesheet href=resource/fonts.css>
<link rel=stylesheet href=src/layout.css>
<link rel=stylesheet href=src/style.css>
<link rel=stylesheet href=markup2/markup.css>
<link rel=stylesheet href=src/theme.css>
<link rel=stylesheet href=src/code.css>
<style id=$customCSS></style>

<script src=markup2/langs.js></script>
<script src=markup2/parse.js></script>
<script src=markup2/legacy.js></script>
<script src=markup2/render.js></script>
<script src=markup2/runtime.js></script>
<script src=markup2/helpers.js></script>

<script src=markup2/url.js></script>

<script src=src/fill.js></script>

<script src=src/ABOUT.js></script>
<script src=src/entity.js></script>
<script src=src/activity.js></script>
<script src=src/request.js></script>
<script src=src/socket.js></script>

<script src=src/keyboard.js></script>
<script src=src/draw.js></script>
<script src=src/input.js></script>

<script src=src/view.js></script>
<script src=src/settings.js></script>
<script src=src/scroller.js></script>
<script src=src/sidebar.js></script>
<script src=src/chat.js></script>

<script src=src/Views/page.js></script>
<script src=src/Views/user.js></script>
<script src=src/Views/comments.js></script>

<script src=src/navigate.js></script>

<script src=src/main.js></script>
<!--END-->

<body class='COL'>

<!--=======\
|| HEADER ||
\========-->

<header class='titlePane bar rem2-3 loadBG' id=$titlePane>
	<div class='textItem rightAlign'>
		<button id=$openSidebar class='item'>
			<span id=$socketPending></span>
			| | |
			<!--<img src=resource/iconbig.png alt="SBS" width=32px height=32px>‚•Ñ-->
		</button>
	</div>
	<noscript>This web-site requires JavaScript</noscript>
	<h1 id=$pageTitle class='textItem pageTitle'></h1>
	<span data-view=page><a class='textItem' id=$pageCommentsLink>[Logs]</a></span>
	<span data-view=user><a class='textItem' id=$userPageLink>[Page]</a></span>
</header>

<horizontal-split class='FILL resize-box ROW'>
	<main class='FILL SLIDES' id=$main_slides>
		<!--==============\
		|| MAIN CONTENTS ||
		\===============-->
		<div data-slide=error class='errorPage' id=$errorMessage></div>
		
		<div data-slide=comments>
			<div id=$commentSearch class='nav'>
				<br id=$commentSearchForm>
				<button id=$commentSearchButton>üîçSearch</button>
				<button id=$commentSearchPrev>‚óÄprev</button>
				<button id=$commentSearchNext>next‚ñ∂</button>
				<span id=$commentSearchStatus></span>
			</div>
			<div id=$commentSearchResults></div>
		</div>
		
		<div data-slide=test>
			<textarea id=$testTextarea></textarea><br>
			<button id=$testButton>Run</button><br>
			<div id=$testOut class='pre'></div>
			<textarea id=$testInput></textarea><br>
			<div style='display:flex;'>
				<div id=$testOut2 class='pre'></div>
				<div id=$testOut3 class='pre'></div>
				<div id=$testOut4 class='pre'></div>
			</div>
		</div>
		
		<div data-slide=user>
			<img id=$userPageAvatar width=400 height=400>
			<div id=$userPageContents class='pageContents Markup'></div>
		</div>
		
		<div data-slide=page id=$chatContainer class='COL'>
			<div class='FILL SLIDES' id=$chatPaneBox></div>
			<div class='inputPane loggedIn ROW'>
				<div class='showWhenEdit COL'>
					<input id=$chatMarkupSelect placeholder="markup" style="width:50px;">
					<button class='FILL' id=$chatCancelEdit>Cancel Edit</button>
				</div>
				<textarea-container class='FILL'>
					<div id=$chatTextareaWidth></div>
					<textarea class='chatTextarea' id=$chatTextarea accesskey="z"></textarea>
				</textarea-container>
				<div class='COL'>
					(temp)
					<button class='FILL' id=$chatSendButton>Send</button>
				</div>
			</div>
		</div>
	</main>
	
	<!--========\
	|| SIDEBAR ||
	\=========-->
	
	<resize-handle id=$horizontalResize class='sidebar-element'></resize-handle>
	
	<sidebar-container id=$sidebar class='sized resize-box sidebar-element COL'>
		<button class='closeSidebar' id=$closeSidebar>Close Sidebar</button>
		
		<div class='userlist bar rem1-5' id=$sidebarUserList></div>
		
		<tab-list id=$sidebar_tabs role="tablist" aria-label="sidebar tabs"></tab-list>
		
		<div id=$sidebarTop class='sized SLIDES'>
			
			<sidebar-panel id=$sidebarActivityPanel>
				<scroll-outer id=$sidebarActivity tabindex=-1></scroll-outer>
			</sidebar-panel>
			
			<sidebar-panel id=$sidebarWatchPanel>
				<scroll-outer><scroll-inner id=$sidebarWatch class='border-list-2'></scroll-inner></scroll-outer>
			</sidebar-panel>
			
			<sidebar-panel id=$sidebarNavPanel>
				<div class='bar rem1-5 ROW'>
					<input class='FILL item' id=$searchInput>
					<button id=$searchButton class='item'>Search</button>
				</div>
				<div id=$searchResults role='list'></div>
				<div id=$sidebarCategories></div>
			</sidebar-panel>
			
			<sidebar-panel id=$sidebarFilePanel class='COL'>
				<div class='rem1-5 justify-between ROW'>
					<input type=file accept="image/png,image/jpeg,image/gif,image/bmp,image/webp,.png,.jpg,.jpeg,.gif,.bmp" id=$file_browse class='FILL item'>
					<button id=$file_cancel class='item'>Cancel</button>
					<button id=$file_url_insert class='item'>Insert</button>
					<input readonly class='FILL item' id=$file_url>
					<button id=$file_done class='item'>Done</button>
					<button id=$file_upload class='item'>Upload Image</button>
				</div>
				<br id=$file_upload_form>
				<div class='FILL image-box' style="min-height: 3rem;"><img id=$file_image></div>
			</sidebar-panel>
			
			<sidebar-panel id=$sidebarUserPanel>
				<div class='registerBox'>
					<button onclick='RELOAD()'>Reload Page</button>
					<button onclick='Lp.start_websocket(true)'>Reset Socket</button>
					<button class='rightAlign' id=$logOut>Log out</button>
				</div>
				<div class='loggedOut'>
					<div class='registerBox'>
						<h2>Log In</h2>
						<form id=$loginForm method=dialog>
							<input placeholder=Username name=username><br>
							<input placeholder=Password name=password type=password autocomplete=current-password><br>
							<button>Log In</button>
						</form>
						<div id=$loginError></div>
					</div>
				</div>
				<div class='loggedIn border-list'>
					<div class='registerBox'>
						<div id=$localSettings></div>
						<button id=$localSettingsSave>Update sitejs/sitecss</button>
					</div>
				</div>
			</sidebar-panel>
		</div>
		
		<resize-handle id=$sidebarResize></resize-handle>
		
		<div class='FILL' id=$sidebarBottom>
			<scroll-outer>
				<scroll-inner id=$sidebarScroller class='border-list'></scroll-inner>
			</scroll-outer>
		</div>
	</sidebar-container>
	
</horizontal-split>

<script hidden>'use strict'
	document.currentScript.remove() // üí≠
	// whitespace between nodes in html (due to line breaks, indentation, etc.) creates text nodes which need to be stripped:
	{
		let n = 0
		document.createNodeIterator(
			document.body, NodeFilter.SHOW_TEXT,
			{acceptNode(node){
				if (!node.data.trim())
					node.remove(), n++
			}},
		).nextNode()
		console.log("üåÖ removed "+n+" blank textnodes")
	}
</script>
