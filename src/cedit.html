<!doctype html>
<meta charset=utf-8>
<meta name=viewport content="width=device-width, initial-scale=1, height=device-height">

<style>
	html {
		white-space: pre-wrap;
	}
	#\$out {
		border: 3px solid red;
	}
	#\$hell {
		border: 10px solid black;
	}
	#\$hell br {
	}
	#\$hell div {
		border: none;
		outline: red solid 3px;
		display: inline-block;
		width: 100%;
	}
	body {
		display: flex;
	}
	body > * {
		flex-grow: 1;
		flex-basis: 0;
	}
	/*girl touhou green hair red vest hugging sleeping near girl dark black hair black dress red blue tendrils*/

</style>
<div contenteditable id=$hell><div><br></div><br></div>
<div id=$out></div>
<script>
	$hell.oninput = ()=>{
		// 1->1
		// 2->1
		// 3->2
		// 4->2
		// 5->3
		let x = $hell.innerText
		x = x.replace(/\n$/, "")
		x = x.replace(/\n\n/gm, "\n")
		let h = $hell.innerHTML.replace(/<div>/g, "\n")
		h = h.replace(/<\/div>/g, "")
		h = h.replace(/<br>/g, "\n")
		// \n\n -> \n
		// \n$
		console.log(x.replace(/\n/g, "@"))
		$out.textContent = x.replace(/^/mg, "ðŸŸ§")+"ðŸ”¸"
		$out.textContent += "\n"+$hell.innerHTML
		$out.textContent += "\n\n"+$hell.innerText.replace(/\n/g, "@")
		$out.textContent += "\n\n"+h.replace(/\n/g, "$")
		
		let last = 'text'
		let content = ""
		document.createNodeIterator(
			$hell, NodeFilter.SHOW_ALL,
			{acceptNode(node) {
				if (node instanceof Text) {
					if (last=='block')
						content += "\n"
					last = 'text'
					content += node.data
				} else if (node instanceof HTMLBRElement) {
					content += "\n"
					last = 'newline'
				} else if (node instanceof HTMLDivElement) {
					if (last=='text')
						content += "\n"
					
				}
			}},
		).nextNode()

	}
	$hell.oninput()
</script>
