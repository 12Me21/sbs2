<!doctype html>
<meta charset=utf-8>
<meta name=viewport content="width=device-width, initial-scale=1, height=device-height">

<style>
	textarea-container {
		width: 300px;
		height: 100px;
		display: block;
		position: relative;
	}
	textarea-container > * {
		white-space: pre-wrap;
		word-break: break-word;
		position: absolute;
		display: block;
		resize: none;
		width: 100%;
		height: 100%;
		margin: 0;
		padding: 0;
		border: 3px solid black;
		font: 1em monospace;
		font-kerning: none;
		font-variant-ligatures: none;
		font-variant-alternates: annotation(1);
		overflow-y: scroll;
	}
	textarea-container > textarea {
		color: transparent;
		caret-color: black;
		text-shadow: 1px 1px #0008;
	}
	textarea-overlay {
		pointer-events: none;
		color: red;
	}
	textarea-overlay span {
		position: relative;
		color: blue;
	}
/*	textarea-overlay span::after {
		position: absolute;
		font-weight: bold;
		left: 0;
		top: 0;
		color: blue;
		display: inline;
		content: attr(data-text);
		font-style: italic;
	}*/
</style>
<textarea-container><textarea id=$i></textarea><textarea-overlay id=$o></textarea-overlay></textarea-container>

<script>
	$i.addEventListener('input', e=>{
		$o.innerHTML = $i.value.replace(/&/g, "&AMP").replace(/</g, "&LT").replace(/\D+/g, "<span data-text='$&'>$&</span>")
		$o.scrollTop = $i.scrollTop
	}, {passive: true})
	$i.addEventListener('scroll', e=>{
		$o.scrollTop = $i.scrollTop
		console.log($o.scrollTop)
	}, {passive: true})
</script>
